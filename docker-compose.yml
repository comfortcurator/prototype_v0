version: "3.9"

services:
  web:
    image: node:20-alpine
    working_dir: /app
    command: >
      sh -c "corepack enable &&
             pnpm install --frozen-lockfile &&
             pnpm --filter web prisma migrate deploy &&
             pnpm --filter web build &&
             pnpm --filter web start"
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: production
      PORT: 3000
    env_file:
      - .env.production
    volumes:
      - ./:/app

